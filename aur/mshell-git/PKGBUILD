pkgname=mshell-git
_pkgname=mshell
pkgver=r4.075d1fe
pkgrel=1
pkgdesc='Material Shell'
arch=(x86_64)
url="https://github.com/BluewyDiamond/$_pkgname"
depends=(nushell gjs gtk4-layer-shell)
makedepends=(
   bun
   aylurs-gtk-shell-git
   libastal-4-git
   libastal-apps-git
   libastal-battery-git
   libastal-git
   libastal-gjs-git
   libastal-io-git
   libastal-niri-git
   libastal-notifd-git
   libastal-powerprofiles-git
   libastal-tray-git
   libastal-wireplumber-git
)
provides=($_pkgname)
conflicts=($_pkgname $_pkgname-bin $_pkgname-git)
source=("git+$url.git")
sha256sums=('SKIP')

pkgver() {
   cd "$srcdir/$_pkgname"
   printf "r%s.%s" "$(git rev-list --count HEAD)" "$(git rev-parse --short=7 HEAD)"
}

build() {
   cd "$srcdir/$_pkgname"
   ./cli.nu build
}

package() {
   cd "$srcdir/$_pkgname"
   install -Dm644 target/debug/main.js -t "$pkgdir/usr/share/$_pkgname"
   install -Dm755 rsc/mshell -t "$pkgdir/usr/bin"
}
